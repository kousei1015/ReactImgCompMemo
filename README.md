## Reactjsでの画像圧縮ライブラリ(browser-image-compressionとreact-image-file-resizer)の比較

フロントエンド側から画像をバックエンド側へ送ることは多いでしょう。その際、画像のデータサイズが大きくならないように、リサイズしたり、圧縮したいということもあると思います。恐らく、画像をリサイズ、圧縮する処理は、フロントエンド側ではなく、バックエンド側で行わせることの方が多いのではないでしょうか。しかし、どうしてもバックエンド側でそのような処理を任せたくないということもあるかもしれません。私の場合、フロントエンドはReactjsで、バックエンドはDjangoで開発していたのですが、画像のリサイズ、圧縮をしてくれるライブラリを導入しようとした際、django-imagekitというライブラリしか見つけられなかったのですが、そのライブラリはあまりメンテナンスされていない上に、情報量もあまりない(使い方に関する日本語の記事は数件しかヒットしないかつ5年以上前に書かれていた)ものだったので、フロントエンド側でそのような処理をしてくれるライブラリがないか見てみました。といってもあまりそのようなライブラリを見つけられることができず、Reactjsで使えそうなものは2つしか見つけられませんでした。ですので、この2つのライブラリを比較していこうと思います。**結論から言うと、強いているならbrowser-image-compressionの方をお勧めします**。理由はbrowser-image-compressionの方はマルチスレッドで動作するからです。

## browser-image-compressionについて
**特徴**
1. Web Wokerを使用しており、マルチスレッドで動作する

こちらはjavascriptで画像をリサイズ、圧縮を行いライブラリで、もちろんReactjsでも動作させることが可能です。最大の特徴は画像のリサイズ、圧縮関係の処理は**Web Worker**で行ってくれるので、UIスレッドのブロッキングを防ぐことが可能で、ユーザー体験的にはとても良いと思います。ちなみにWeb WorkerとはJavascriptでもマルチスレッド処理を可能にしてくれるものです(といってもWeb Worker側には直接DOMを操作することができない、という制約があります)。ソースコードを見る限り、Web Worker内でも描画処理を行える[OffscreenCanvas](https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas)を使用しているようです。これらのAPIを用いることでマルチスレッドで動かしており、メインスレッドが占有されず、それによりUIブロッキングも起きません。余談ですが、CDNでも読み込めます。

## react-image-file-resizerについて
1. FileReaderAPIを使っており、メインスレッドを占有する

こちらはReactjsでは使えますが、Vanilla jsでは使えないでしょう。このライブラリのバージョンは0.4.8です。こちらは詳しくは説明していませんが。メインスレッドを占有することが多いため、UIブロッキングが起きる可能性があります。

## 結論
先ほど、browser-image-compressionの方がおすすめだと書きましたが、正直、アップロードされる画像のデータサイズがそれほど大きくはない場合だと、UIブロッキングは大きな問題にはならない(UIブロッキングが起きてもほんのわずかな時間しか発生しない)ので、好みで決めてもいいと思います。
